<!DOCTYPE html>
<html lang="en" id="head">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta http-equiv="X-UA-Compatible" content="ie=edge">
   <title>EPCarpool</title>
   <link href="./bulma.min.css" rel="stylesheet" type="text/css" />
   <link href="./style.css" rel="stylesheet" type="text/css" />
   <script src="https://kit.fontawesome.com/16ae8e710d.js" crossorigin="anonymous"></script>
   <link rel="icon" href="favicon.png" type="image/x-icon">
   <meta charset="UTF-8">
   <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
   <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <script src="/co2Tracker.js"></script>
</head>

<body>
   <main>
      <!--Error header-->
      <% if (error) { %>
         <article class="message is-danger" id="error">
            <div class="message-header">
               <p>Warning</p>
               <button class="delete" aria-label="delete" onclick="const errorElement = document.getElementById('error');
                errorElement.remove();"></button>
            </div>
            <div class="message-body">
               <%= error %>
            </div>
         </article>
         <% } %>

            <% if (message) { %>
               <article class="message is-success" id="error">
                  <div class="message-header">
                     <p>Success</p>
                     <button class="delete" aria-label="delete" onclick="const successElement = document.getElementById('error');
                  successElement.remove();"></button>
                  </div>
                  <div class="message-body">
                     <%= message %>
                  </div>
               </article>
               <% } %>
                  <section class="hero is-fullheight" id="hero">
                     <!-- Hero head: will stick at the top -->
                     <div class="hero-head">
                        <header class="navbar">
                           <div class="container">
                              <div class="navbar-brand">
                                 <a class="navbar-item">
                                    <div style="position: relative; display: flex; align-items: center;">
                                       <img src="EPS Logo - Transparent-4.png" alt="Logo">
                                       <h1 class="title is-3" style="margin-left: 10px; margin-bottom: -10px">EPCarpool
                                       </h1>
                                       <span
                                          style="position: absolute; top: -5px; right: -25px; background: #3273DC; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7em; font-weight: bold;">BETA</span>
                                    </div>
                                 </a>
                                 <div class="navbar-item" style="padding: 0.5rem 1.25rem;">
                                    <button class="button is-info is-light" onclick="showDisclaimer()">
                                       <span class="icon">
                                          <i class="fas fa-info-circle"></i>
                                       </span>
                                    </button>
                                 </div>
                                 <span class="navbar-burger" data-target="navbarMenuHeroC" id="nav-toggle">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                 </span>
                              </div>
                              <div id="navbarMenuHeroC" class="navbar-menu ">
                                 <div class="navbar-end">
                                    <div class="is-button is-link">
                                       <div class="navbar-item">
                                          <span style="font-size: 1em; color: #30B700; float: right; display: flex; align-items: center; margin-right: 15px;">
                                             <a class="fa-solid fa-leaf" href="/sustainabilityStatement"
                                                style="color: #30B700; margin-right: 10px;"></a>

                                             <span>
                                                <span id="co2-savings" style="font-size: 0.9em; font-weight: bold;">0 kg CO₂ saved</span>
                                                <span id="co2-equivalents" class="co2-equivalents"></span>

                                             </span>
                                          </span>
                                          <div class="buttons" style="margin: 10px;margin-right: 0px;">
                                              <button class="button is-info is-outlined" onclick="openSettings()" style="margin-right: 5px;">
                                                 <span class="icon">
                                                    <i class="fas fa-cog"></i>
                                                 </span>
                                                 <span>Interests</span>
                                              </button>
                                              <a class="button is-link is-outlined" href="/logout">
                                                 Log out
                                              </a>
                                             <div class="navbar-item has-dropdown is-hoverable "
                                                onclick="document.getElementById('navbar-dropdown').style.visibility = 'visible';">
                                                <a class="button is-link" id="name_button"
                                                   style="background: linear-gradient(105deg, #3273DC, #275CBF);">
                                                   <%= firstName %>
                                                      <%= lastName %>
                                                         <i style="margin-left: 5px;" class="fas fa-angle-down"
                                                            aria-hidden="true"></i>
                                                </a>
                                                <div id="filler"
                                                   style="width: 130px; background-color: transparent; height: 20px; position: absolute; margin-top: -15px;">
                                                </div>
                                                <div class="navbar-dropdown" id="navbar-dropdown">
                                                   <a class="navbar-item" href="/updateSettings">
                                                      Update settings
                                                   </a>
                                                   <a class="navbar-item" href="https://forms.office.com/r/deCSjA7bCR">
                                                      Report a bug
                                                   </a>
                                                   <a class="navbar-item" href="/sustainabilityStatement">
                                                      Sustainability statement
                                                   </a>
                                                   <hr class="navbar-divider">
                                                   <div class="navbar-item">
                                                      Version <%= process.env.VERSION %>
                                                   </div>
                                                </div>
                                             </div>
                                             </nav>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </header>
                     </div>
                     <!-- Hero content: will be in the middle -->
                     <div class="hero-body" id="hero-body">
                        <div>
                           <!-- <div class="container has-text-centered"> -->
                           <!-- <p class="title">
                     Title
                     </p>
                     <p class="subtitle">
                     Subtitle
                     </p> -->
                           <!-- <div class="wrapper" style="margin-top:-30px; margin-bottom: 30px; ">
                     <div class="container-calendar" >
                       <div id="left" style="margin-right: 15px;">
                          <h1>Calendar</h1>
                           <div id="event-section">
                               <h3>Add Event</h3>
                             <input type="date" id="eventDate">
                             <input type="time" id="eventTime">
                               <input type="text"
                                   id="eventTitle"
                                   placeholder="Event Title">
                               <input type="text"
                                   id="eventDescription"
                                   placeholder="Location">
                               <button id="addEvent" onclick="addEvent()">
                                   Add
                               </button> 
                           </div>
                           <div id="reminder-section">
                               <h3>Reminders</h3>
                               <!-- List to display reminders -->
                           <!--<div  type="button" style="font-size: 15px; margin-top: 10px; background-color: #eee; border-radius: 0px; padding-top: 5px; padding-bottom: 5px;" class="collapsible" id="collapsible1">My carpools<i style="margin-left: 5px;" class="fa-solid fa-angle-right" id="carpools-caret"></i></div>
                     <div class="content" style="display: none;">
                     
                     
                       <ul id="reminderList">
                     
                           <li data-event-id="1">
                               <strong>Event Title</strong>
                               - Event Description on Event Date
                               <button class="delete-event"
                                   onclick="deleteEvent(1)">
                                   Delete
                               </button>
                           </li>
                       </ul>
                        </div>
                     </div>
                     </div>
                     <div id="right">
                     <h3 id="monthAndYear"></h3>
                     <div class="button-container-calendar">
                       <button id="previous"
                               onclick="previous()">
                             ‹
                         </button>
                       <button id="next"
                               onclick="next()">
                             ›
                         </button>
                     </div>
                     <table class="table-calendar"
                          id="calendar"
                          data-lang="en">
                       <thead id="thead-month"></thead>
                       <!-- Table body for displaying the calendar -->
                           <!--<tbody id="calendar-body"></tbody>
                     </table>
                     <div class="footer-container-calendar">
                         <label for="month">Jump To: </label>
                         <!-- Dropdowns to select a specific month and year -->
                           <!--<select id="month" onchange="jump()">
                     <option value=0>Jan</option>
                     <option value=1>Feb</option>
                     <option value=2>Mar</option>
                     <option value=3>Apr</option>
                     <option value=4>May</option>
                     <option value=5>Jun</option>
                     <option value=6>Jul</option>
                     <option value=7>Aug</option>
                     <option value=8>Sep</option>
                     <option value=9>Oct</option>
                     <option value=10>Nov</option>
                     <option value=11>Dec</option>
                     </select>
                     <!-- Dropdown to select a specific year -->
                           <!--<select id="year" onchange="jump()"></select>
                     </div>
                     </div>
                     </div>
                     </div>
                     ,
                     {
                     
                     }
                     -->
                        </div>
                        <!-- </div>  -->
                        <div class="container">
                           <div class="columns " style="width: 100%; margin-left: 0px; margin-top: -50px;">
                              <div class="column has-text-centered" id="upcoming-carpools-column"
                                 style="margin-left: 0px; margin-right: 0px; overflow:auto;">
                                 <div class="container " style="margin-top: 5px; ">
                                    <div id="carpoolsJS">
                                     </div>
                                  </div>
                                  
                                  <!-- Recommended Carpools Section -->
                                  <div class="box" style="margin-top: 30px;">
                                     <h2 class="title is-4">Recommended Carpools</h2>
                                     <p class="subtitle is-6">Based on your interests and available carpools</p>
                                     <div id="recommendedCarpools">
                                        <div class="has-text-centered" id="recommendedCarpoolsLoading">
                                           <span class="icon is-medium">
                                              <i class="fas fa-spinner fa-pulse"></i>
                                           </span>
                                           <p>Loading recommendations...</p>
                                        </div>
                                     </div>
                                  </div>
                               </div>
                            </div>
                        </div>
                     </div>
                     <!-- Include the JavaScript file for the calendar functionality -->
                     <script src="./script.js"></script>
                     <!-- Hero footer: will stick at the bottom -->
                     <div class="hero-foot">
                        <nav class="tabs is-boxed is-fullwidth">
                           <div class="container">
                              <ul>
                                 <li><a href="/" class="white">Upcoming Events</a></li>
                                 <li class="is-active" class="white"><a href="/mycarpools" class="is-active1">My
                                       Carpools
                                       <span id="pending-badge"
                                          style="background: #ff3860; color: white; border-radius: 10px; padding: 2px 8px; font-size: 0.8em; margin-left: 5px; display: none;"></span>
                                    </a></li>
                              </ul>
                           </div>
                        </nav>
                     </div>
                     </div>
                  </section>
   </main>

   <!-- Settings Modal -->
   <div class="modal" id="settingsModal">
      <div class="modal-background" onclick="closeModal('settingsModal')"></div>
      <div class="modal-card" style="max-width: 500px;">
         <header class="modal-card-head">
            <p class="modal-card-title">My Interests</p>
            <button class="delete" aria-label="close" onclick="closeModal('settingsModal')"></button>
         </header>
         <section class="modal-card-body">
            <div class="content">
               <p>Select your interests to get personalized carpool recommendations:</p>
               <div class="field" id="interestsContainer" style="margin-top: 1rem;">
                  <!-- Interests will be populated by JavaScript -->
                  <div class="has-text-centered" id="interestsLoading">
                     <span class="icon is-medium">
                        <i class="fas fa-spinner fa-pulse"></i>
                     </span>
                     <p>Loading interests...</p>
                  </div>
               </div>
            </div>
         </section>
         <footer class="modal-card-foot" style="justify-content: flex-end;">
            <button class="button is-link" id="saveInterestsBtn" onclick="saveInterests()">
               <span class="icon">
                  <i class="fas fa-save"></i>
               </span>
               <span>Save Changes</span>
            </button>
            <button class="button" onclick="closeModal('settingsModal')">Cancel</button>
         </footer>
      </div>
   </div>
</body>
<!-- start here -->
<div class="modal" id="modal-js-edit">
   <div class="modal-background" style="background-color: rgba(10,10,10,.50)"></div>
   <div class="modal-card" style="">
      <p class="panel-heading has-text-centered" style="padding: 15px;">
         Edit Carpool
         <button class="delete" aria-label="" onclick="AllModals()" style="float: right"></button>
      </p>
      <section class="modal-card-body">

         <div class="container">
            <div class="field">
               <a class="panel-block" style="border-radius: 5px; padding:0px;">
                  <input style="margin-right: 10px;" id="email" class="input" type="email" placeholder="Driver email">
                  <input id="phone" class="input" type="tel" placeholder="Driver phone number">
               </a>
            </div>
            <div class="field" style="margin-bottom: 10px;">
               <input class="input" id="carmake" type="text" placeholder="Car make and model">
            </div>
            <div class="field" style="margin-bottom: 10px;">
               <input class="input" id="seats" type="number" min="1" max="9"
                  placeholder="Number of available car seats">
            </div>
            <div style="display: flex; gap: 10px;">
               <div>
                  <label>Pickup Location </label>
                  <div class="field" style="margin-bottom: 10px;">
                     <div class="control">
                        <div class="select">
                           <form>
                              <select id="route-type">
                                 <option value="route">Riders' Homes</option>
                                 <option value="point">Common meeting point</option>
                                 <option value="eps-campus">EPS Campus</option>
                              </select>
                           </form>
                        </div>
                     </div>
                  </div>
               </div>
               <div>
                  <label>Arrival time</label>
                  <div class="field" style="margin-bottom: 10px;">
                     <input class="input" id="arrivaltime" type="time" placeholder="Time to arrive">
                  </div>
               </div>
            </div>
         </div>

         <div class="field" style="margin-bottom: 18px;">
            <label id="address-label">Your home address </label>
            <script>
               const routeTypeSelect123 = document.getElementById('route-type');
               const addressLabel123 = document.getElementById('address-label');

               function updateAddressLabel123() {
                  const selectedOption123 = routeTypeSelect123.value;
                  if (selectedOption123 === 'route') {
                     addressLabel123.innerHTML = 'Your home address';
                     document.getElementById("address-input").disabled = false;
                     if (value2 != "none") {
                        document.getElementById("address-input").value = value2;
                     }
                  } else if (selectedOption123 === 'point') {
                     addressLabel123.innerHTML = 'Meeting point';
                     document.getElementById("address-input").value = "";
                     document.getElementById("address-input").disabled = false;
                  } else if (selectedOption123 === 'eps-campus') {
                     addressLabel123.innerHTML = 'EPS Campus';
                     document.getElementById("address-input").value = "10613 NE 38th Place, Kirkland, WA 98033";
                     document.getElementById("address-input").disabled = true;
                  }
               }

               routeTypeSelect123.addEventListener('change', updateAddressLabel123);
            </script>
            <div class="autocomplete-container" id="">
               <div class='control' id="autocomplete-container">
               </div>
            </div>
         </div>
         <div class="field">
            <label>Manage carpool</label>

            <div id="deleteCarpoolBtn">
               <div class="buttons" style="margin-bottom: 0px">
                  <div class="button is-danger is-light" style="margin-bottom: 10px" onclick="preperation();">Delete
                     carpool</div>
               </div>
            </div>

            <table class="table " style="">
               <thead>
                  <tr>
                     <th><abbr title="Friend">Carpooler</abbr></th>
                     <th>Email</th>
                     <th>Phone</th>
                     <th>Remove</th>
                  </tr>
               </thead>
               <tbody id="friendsInCarpool">
                  <!--<tr>
                     <th ><a href="mailto:ajosan@eastsideprep.org">Anmol Josan</a></th>
                     <td><a style="color: black">X</a></td>
                  </tr>
                  <tr>
                     <th ><a href="mailto:ayamashita@eastsideprep.org">Ari Yamashita</a></th>
                     <td><a style="color: black">X</a></td>
                  </tr>
                  <tr>
                     <th ><a href="mailto:pjain@eastsideprep.org">Praneel Jain</a></th>
                     <td><a style="color: black">X</a></td>
                  </tr>
                  -->
               </tbody>
            </table>

         </div>
      </section>
      <footer class="modal-card-foot" style="background-color: white; border-width: 1px; padding: 10px; ">
         <div class="buttons" style="margin-left: 0px;">
            <button class="button is-link " style="background: linear-gradient(105deg, #3273DC, #275CBF);"
               onclick="test()">Apply</button>
            <button class="button" aria-label="" onclick='document.getElementById("modal-js-edit").classList.remove("is-active");'>Cancel</button>
         </div>
      </footer>
   </div>
</div>
<!-- end here -->

</html>

<script src="/carpools.js"></script>

<div class="modal" id="disclaimer-modal">
   <div class="modal-background"></div>
   <div class="modal-card">
      <section class="modal-card-body" style="border-radius: 6px 6px 0px 0px;">
         <p class="has-text-centered is-size-5">Eastside Preparatory School does not mandate or encourage the use of
            this application. They do not claim any responsibility for the maintenance, upkeep, and development of this
            application. This is entirely student-run.</p>
      </section>
      <footer class="modal-card-foot">
         <div class="buttons">
            <div class="button center is-link" onclick="closeDisclaimer()"
               style="background: linear-gradient(105deg, #3273DC, #275CBF); margin-top: 20px; margin-bottom: -20px">
               Close</div>
         </div>
      </footer>
   </div>
</div>
</body>
</html>